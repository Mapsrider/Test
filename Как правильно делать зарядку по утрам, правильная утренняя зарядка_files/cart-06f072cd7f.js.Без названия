function updateCartSum(t){product_sum_change_callback_timer&&clearTimeout(product_sum_change_callback_timer),product_sum_change_callback_timer=setTimeout(function(){$(".js-discount-code").prop("readonly",!0);var t=$("#product_cart_form"),e=t.serialize();$.ajax({type:"POST",url:t.data("change"),data:e,success:function(e){callbackAction(e,t)},error:function(t,e){}})},t||500)}function updateCartSums(t){var e=t.closest(".js-product");if(e.length){var a=parseInt(e.find(".js-price").data("price")),n=parseInt(e.find(".js-quantity-input").val()),r=e.find(".js-amount"),u=$(".js-total-amount"),o=a*n,s=o-parseInt(r.data("amount")),i=parseInt(u.data("total")+s);r.data("amount",o),r.text(number_format(o,0,"."," ")+"Ñ€"),u.data("total",i),updateCartSum()}}var $cart_form=$("#product_cart_form"),order_sum_el=document.getElementById("sum_opt"),product_sum_change_callback_timer,timer;$body.on("click",".js-quantity",function(){var t=$(this),e=parseInt(t.data("num")),a=t.parent().find(".js-quantity-input"),n=parseInt(a.val()),r=n+e;r>0&&a.val(r),"undefined"!=typeof t.data("submit")?t.closest("form").submit():updateCartSums(t)}),$body.on("keyup",".js-quantity-input",function(){clearTimeout(timer);var t=$(this);timer=setTimeout(function(){"undefined"!=typeof t.data("submit")?t.closest("form").submit():updateCartSums(t)},1e3)}),$cart_form.find(".js-quantity-input, .js-offer-count").change(function(){this.value=Math.max(Math.min(parseInt(this.value),this.max),this.min)||this.min;var t=$(this).closest("tr"),e=t.get(0).querySelector(".js-price-total"),a=0,n=0;$(t).find(".js-offer-count").each(function(t,e){a+=parseInt(e.value*e.dataset.price_opt)}),e.innerHTML=number_format(a,0,"."," "),a=0,$cart_form.find(".js-offer-count").each(function(t,e){a+=parseInt(e.value)*e.dataset.price_opt,n+=parseInt(e.value)*e.dataset.price}),order_sum_el.innerHTML=number_format(a,0,"."," "),document.getElementById("profit").innerHTML=number_format(n-a,0,"."," "),updateCartSum(5e3)}),$body.on("click",".js-cart-submit",function(t){var e=$(this),a=e.data("is_fast");document.getElementById("is_fast").value=a,a&&(t.preventDefault(),formSubmit(e.closest("form")))}),$body.on("input",".js-use-points",function(t){var e=$("#sum"),a=document.getElementById("hidden_sum"),n=$(".js-use-points"),r=parseInt(a.value),u=parseInt(n.data("cost")),o=parseInt(n.val())*u;r<o&&(o=r-r%u,n.val(o/u));var s=r-o;e.text(number_format(s,0,"."," ")),console.log(t.type),"input"===t.type&&updateCartSum(2e3)}),$body.on("input",".js-discount-code:not(.active)",function(){this.value.length>0&&updateCartSum(2e3)}),$body.on("keypress",".js-use-points",function(t){13===t.keyCode&&(t.preventDefault(),$(this).change())}),$(".js-offer-inc").click(function(){var t=this.parentNode,e=t.querySelector(".js-offer-count"),a=parseInt(e.value);a<e.max&&(e.value=++a,$(e).change())}),$(".js-offer-dec").click(function(){var t=this.parentNode,e=t.querySelector(".js-offer-count"),a=parseInt(e.value);a>e.min&&(e.value=a-1,$(e).change())});